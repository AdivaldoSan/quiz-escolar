<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Minhas Turmas</title>
</head>

<body style="font-family:Arial;max-width:600px;margin:auto;">

<h2>ðŸ“š Minhas Turmas</h2>

<div>
    <input id="novaTurma" placeholder="Ex: 3Âº A" style="padding:6px;width:70%">
    <button onclick="adicionar()">Adicionar</button>
</div>

<hr>

<div id="listaTurmas">Carregando...</div>

<script src="./js/conexao.js"></script>

<script>

async function carregar(){

    const token = localStorage.getItem("TOKEN");

    if(!token){
        window.location.href = "index.html";
        return;
    }

    const r = await fetch(API + "?tipo=turmas&token=" + token);
    const dados = await r.json();

    const div = document.getElementById("listaTurmas");
    div.innerHTML = "";

    if(dados.erro){
        div.innerHTML = "Erro ao carregar turmas.";
        return;
    }

    if(dados.length <= 1){
        div.innerHTML = "Nenhuma turma cadastrada.";
        return;
    }

    dados.slice(1).forEach(l=>{

        const nome = l[2];

        div.innerHTML += `
            <div style="margin-bottom:8px;">
                ${nome}
                <button onclick="excluir('${nome}')">Excluir</button>
            </div>
        `;
    });
}


async function adicionar(){

    const token = localStorage.getItem("TOKEN");
    const nome = document.getElementById("novaTurma").value.trim();

    if(!nome){
        alert("Digite o nome da turma.");
        return;
    }

    const r = await fetch(API,{
        method:"POST",
        body:JSON.stringify({
            tipo:"addTurma",
            token: token,
            nomeTurma: nome
        })
    });

    const resp = await r.json();

    if(resp.erro){
        alert(resp.erro);
        return;
    }

    document.getElementById("novaTurma").value="";
    carregar();
}


async function excluir(nome){

    const token = localStorage.getItem("TOKEN");

    if(!confirm("Deseja desativar esta turma?")) return;

    const r = await fetch(API,{
        method:"POST",
        body:JSON.stringify({
            tipo:"excluirTurma",
            token: token,
            nomeTurma: nome
        })
    });

    const resp = await r.json();

    if(resp.erro){
        alert(resp.erro);
        return;
    }

    carregar();
}

carregar();

</script>

</body>
</html>
