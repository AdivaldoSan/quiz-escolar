<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Responder Quiz</title>
</head>

<body style="font-family:Arial;max-width:700px;margin:auto;">

<h2 id="tituloQuiz"></h2>

<div id="areaQuestao"></div>

<br>
<button id="btnAvancar" onclick="avancar()">Avançar</button>

<p id="contador"></p>

<script>

const quiz = JSON.parse(localStorage.getItem("quizAtual"));

let atual = 0;
let respostas = [];

document.getElementById("tituloQuiz").innerText = quiz.nome;

mostrarQuestao();


// ==========================
function mostrarQuestao(){

    const q = quiz.questoes[atual];

    document.getElementById("contador").innerText =
        "Questão " + (atual+1) + " de " + quiz.questoes.length;

    document.getElementById("areaQuestao").innerHTML = `
        <p><b>${q.ENUNCIADO}</b></p>

        ${["A","B","C","D"].map(l=>`
            <label>
                <input type="radio" name="resp" value="${l}">
                ${q["ALT_"+l]}
            </label><br><br>
        `).join("")}
    `;

    if(atual === quiz.questoes.length-1){
        document.getElementById("btnAvancar").innerText = "Finalizar";
    }
}


// ==========================
function avancar(){

    const marcada = document.querySelector('input[name="resp"]:checked');

    if(!marcada){
        alert("Marque uma alternativa.");
        return;
    }

    respostas.push({
        questao: quiz.questoes[atual].ID,
        marcada: marcada.value,
        correta: quiz.questoes[atual].GABARITO
    });

    atual++;

    if(atual >= quiz.questoes.length){
        finalizar();
        return;
    }

    mostrarQuestao();
}


// ==========================
function finalizar(){

    let acertos = respostas.filter(r=>r.marcada===r.correta).length;

    document.body.innerHTML = `
        <h2>Quiz finalizado</h2>
        <p>Acertos: ${acertos} de ${respostas.length}</p>
        <p>Você já pode fechar esta página.</p>
    `;

    console.log(respostas); // ainda vamos enviar pro banco
}

</script>

</body>
</html>
