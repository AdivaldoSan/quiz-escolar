<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carregando Atividade</title>
<link rel="stylesheet" href="styles.css">
<link rel="icon" href="favicon.svg" type="image/svg+xml">
<link rel="alternate icon" href="favicon.ico">
</head>

<body class="aluno-page">

<div class="aluno-header">
    ðŸ“˜ Avalia+
</div>

<div class="aluno-container">

    <div class="aluno-card" id="areaMensagem">

        <div class="loader-grande"></div>

        <h2>Preparando sua atividade...</h2>

        <p>
            Aguarde alguns instantes enquanto organizamos
            sua avaliaÃ§Ã£o.
        </p>

    </div>

</div>

<script src="./js/conexao.js"></script>

<script>

// =============================
// CAPTURA ID DA URL
// =============================
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if(!id){
    mostrarErro(
        "Link invÃ¡lido.",
        "Verifique se o endereÃ§o foi copiado corretamente ou solicite novamente ao professor."
    );
    throw new Error("ID nÃ£o informado");
}

// =============================
// BUSCA APLICAÃ‡ÃƒO
// =============================
fetch(API + "?tipo=abrirAplicacao&id=" + id)
.then(r => r.json())
.then(d => {

    if(d.erro){
        mostrarErro(
            "Atividade indisponÃ­vel.",
            "Esta atividade pode ter sido desativada ou o link nÃ£o Ã© mais vÃ¡lido. Procure seu professor."
        );
        return;
    }

    // salva para quiz.html
    localStorage.setItem("quizAtual", JSON.stringify(d));

    // pequeno delay sÃ³ para UX visual
    setTimeout(()=>{
        window.location.href = "quiz.html";
    }, 800);

})
.catch(()=>{
    mostrarErro(
        "Erro ao carregar atividade.",
        "Verifique sua conexÃ£o com a internet e tente novamente."
    );
});


// =============================
// FUNÃ‡ÃƒO DE ERRO PEDAGÃ“GICO
// =============================
function mostrarErro(titulo, mensagem){

    document.getElementById("areaMensagem").innerHTML = `
        <div class="erro-icone">âš </div>
        <h2>${titulo}</h2>
        <p>${mensagem}</p>
    `;
}

</script>

</body>
</html>
