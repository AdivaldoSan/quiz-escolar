<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro - WebQuiz</title>
<link rel="stylesheet" href="styles.css">
</head>

<body class="login-page">

<div class="login-box">

<h2>üìã Primeiro Acesso</h2>

<div class="form-group">
<input type="text" id="nome" placeholder="Nome completo" required>
</div>

<div class="form-group">
<input type="email" id="email" placeholder="Email institucional" required>
</div>

<div class="form-group">
<input type="password" id="senha" placeholder="Senha" required>
</div>

<div class="form-group">
<input type="text" id="escola" placeholder="Escola" required>
</div>

<div class="form-group">
<select id="estado" required onchange="verificarEstado()">
  <option value="">Selecione o Estado</option>
  <option value="RO">RO</option>
  <option value="AC">AC</option>
  <option value="AM">AM</option>
  <option value="AP">AP</option>
  <option value="BA">BA</option>
  <option value="CE">CE</option>
  <option value="DF">DF</option>
  <option value="ES">ES</option>
  <option value="GO">GO</option>
  <option value="MA">MA</option>
  <option value="MG">MG</option>
  <option value="MS">MS</option>
  <option value="MT">MT</option>
  <option value="PA">PA</option>
  <option value="PB">PB</option>
  <option value="PE">PE</option>
  <option value="PI">PI</option>
  <option value="PR">PR</option>
  <option value="RJ">RJ</option>
  <option value="RN">RN</option>
  <option value="RS">RS</option>
  <option value="RR">RR</option>
  <option value="SC">SC</option>
  <option value="SE">SE</option>
  <option value="SP">SP</option>
  <option value="TO">TO</option>
</select>
</div>

<div class="form-group" id="cidadeContainer">
  <input type="text" id="cidadeManual" placeholder="Cidade" required>
</div>

<div class="form-group">
<select id="disciplina" required>
  <option value="">Selecione a Disciplina</option>
  <option value="Matem√°tica">Matem√°tica</option>
  <option value="Portugu√™s">Portugu√™s</option>
  <option value="F√≠sica">F√≠sica</option>
  <option value="Qu√≠mica">Qu√≠mica</option>
  <option value="Biologia">Biologia</option>
  <option value="Hist√≥ria">Hist√≥ria</option>
  <option value="Geografia">Geografia</option>
  <option value="Ingl√™s">Ingl√™s</option>
  <option value="Outra">Outra</option>
</select>
</div>

<div class="termo-box">
<p>
Ao realizar o cadastro, voc√™ concorda que seus dados (nome, email,
institui√ß√£o e disciplina) ser√£o utilizados exclusivamente para fins
educacionais dentro do sistema, incluindo gest√£o de turmas,
aplica√ß√£o de avalia√ß√µes e relat√≥rios pedag√≥gicos.
</p>

<p>
Os dados n√£o s√£o compartilhados com terceiros e podem ser
solicitados para exclus√£o mediante pedido ao administrador.
</p>

<label class="checkbox-termo">
<input type="checkbox" id="aceite">
Declaro que li e concordo com os termos de uso.
</label>
</div>

<button class="btn-login" onclick="cadastrar()">Cadastrar</button>

<p id="msg" class="msg-error"></p>

</div>

<script src="./js/conexao.js"></script>

<script>

async function cadastrar(){

  const nome = document.getElementById("nome").value.trim();
  const email = document.getElementById("email").value.trim();
  const senha = document.getElementById("senha").value.trim();
  const escola = document.getElementById("escola").value.trim();
  const estado = document.getElementById("estado").value;
  const disciplina = document.getElementById("disciplina").value;
  const aceitou = document.getElementById("aceite").checked;

  let cidade = "";

  if(estado === "RO"){
    cidade = document.getElementById("cidadeSelect")?.value || "";
  }else{
    cidade = document.getElementById("cidadeManual").value.trim();
  }

  if(!nome || !email || !senha || !escola || !estado || !cidade || !disciplina){
    mostrarErro("Preencha todos os campos.");
    return;
  }

  if(!aceitou){
    mostrarErro("√â necess√°rio aceitar os termos de uso.");
    return;
  }

  const resposta = await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      tipo:"cadastro",
      nome:nome,
      email:email,
      senha:senha,
      escola:escola,
      cidade:cidade,
      estado:estado,
      disciplina:disciplina
    })
  });

  const dados = await resposta.json();

  if(dados.mensagem){
    mostrarErro("Cadastro realizado. Aguarde aprova√ß√£o do administrador.");
  }else{
    mostrarErro(dados.erro || "Erro no cadastro.");
  }
}

function mostrarErro(msg){
  const el = document.getElementById("msg");
  el.style.display = "block";
  el.innerText = msg;
}

</script>

</body>
</html>
