
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Montar Quiz</title>
</head>

<body style="font-family: Arial; max-width:800px; margin:auto;">

<h2>ğŸ“˜ Montagem de Quiz</h2>

<label>Disciplina:</label>
<select id="disciplina"></select>
<br><br>

<label>Assunto:</label>
<select id="assunto"></select>
<br><br>

<label>Descritor (opcional):</label>
<select id="descritor"></select>
<br><br>

<label>Quantidade de questÃµes:</label>
<input type="number" id="quantidade" value="5">
<br><br>

<label>Nome do Quiz:</label>
<input type="text" id="nomeQuiz" placeholder="Ex: RevisÃ£o FunÃ§Ãµes 3ÂºA">
<br><br>

<button onclick="gerarQuiz()">Gerar Quiz</button>

<p id="resultado"></p>

<script src="js/conexao.js"></script>

<script>

let banco = [];

let banco = [];
let mapaDescritores = {};

carregarBancoCompleto().then(({questoes, descritores}) => {

    banco = questoes.filter(q => q.ATIVO === "SIM");

    // cria mapa CODIGO â†’ DESCRICAO
    descritores.forEach(d => {
        mapaDescritores[d.CODIGO] = d.DESCRICAO;
    });

    preencherSelect("disciplina", [...new Set(banco.map(q => q.DISCIPLINA))]);
    preencherSelect("assunto", [...new Set(banco.map(q => q.ASSUNTO))]);

    // descritor agora mostra significado
    const listaDescritores = [...new Set(banco.map(q => q.DESCRITOR))];

    const select = document.getElementById("descritor");

    listaDescritores.forEach(cod => {
        let op = document.createElement("option");
        op.value = cod;
        op.textContent = cod + " â€” " + (mapaDescritores[cod] || "");
        select.appendChild(op);
    });

});

function preencherSelect(id, lista) {
    const select = document.getElementById(id);
    lista.forEach(item => {
        let op = document.createElement("option");
        op.value = item;
        op.textContent = item;
        select.appendChild(op);
    });
}

function gerarQuiz() {

    const disc = disciplina.value;
    const ass = assunto.value;
    const desc = descritor.value;
    const qtd = parseInt(quantidade.value);
    const nome = nomeQuiz.value || "Quiz sem nome";

    let filtradas = banco.filter(q =>
        q.DISCIPLINA === disc &&
        q.ASSUNTO === ass &&
        (desc === "" || q.DESCRITOR === desc)
    );

    embaralhar(filtradas);

    let selecionadas = filtradas.slice(0, qtd);

   const idAplicacao = "QUIZ_" + Date.now();

    localStorage.setItem("quizAtual", JSON.stringify({
    id: idAplicacao,
    nome: nome,
    questoes: selecionadas
    }));
    window.location.href = "quiz.html";
}

function embaralhar(array){
    for(let i=array.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
}

</script>

</body>
</html>
